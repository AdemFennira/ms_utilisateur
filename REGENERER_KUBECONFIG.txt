╔═══════════════════════════════════════════════════════════════════════════════╗
║                  ACTION REQUISE : RÉGÉNÉRER LE KUBECONFIG                     ║
╚═══════════════════════════════════════════════════════════════════════════════╝

Le problème actuel:
-------------------
Votre kubeconfig utilise l'exec plugin OCI qui nécessite:
- OCI CLI installé
- Configuration OCI complète avec API keys
- Fichier de configuration ~/.oci/config

Cela ne fonctionne pas dans les GitHub Actions runners.

La solution:
-----------
Régénérer le kubeconfig avec un TOKEN au lieu de l'exec plugin.

ÉTAPES À SUIVRE:
===============

1. Ouvrez un terminal/PowerShell sur votre machine

2. Connectez-vous à OCI:
   oci session authenticate --region eu-paris-1

3. Récupérez l'ID de votre cluster OKE:
   oci ce cluster list --compartment-id <votre-compartment-id> --region eu-paris-1

   OU allez dans la console OCI:
   Menu > Developer Services > Kubernetes Clusters (OKE)
   Cliquez sur votre cluster et copiez l'OCID

4. Régénérez le kubeconfig avec un TOKEN:

   oci ce cluster create-kubeconfig \
     --cluster-id <VOTRE_CLUSTER_OCID> \
     --file ~/.kube/config \
     --region eu-paris-1 \
     --token-version 2.0.0 \
     --kube-endpoint PUBLIC_ENDPOINT

   Remplacez <VOTRE_CLUSTER_OCID> par l'OCID de votre cluster.

5. Vérifiez que ça fonctionne localement:
   kubectl get nodes

6. Encodez le kubeconfig en base64:

   Sur Linux/Mac:
   cat ~/.kube/config | base64 -w 0

   Sur Windows PowerShell:
   [Convert]::ToBase64String([System.IO.File]::ReadAllBytes("$env:USERPROFILE\.kube\config"))

7. Mettez à jour le secret GitHub:
   - Allez sur https://github.com/AbdBoutchichi/SmartDish/settings/secrets/actions
   - Cliquez sur OCI_KUBECONFIG
   - Cliquez sur "Update"
   - Collez la nouvelle valeur base64
   - Cliquez sur "Update secret"

8. Relancez votre workflow GitHub Actions

IMPORTANT:
---------
Le token dans le kubeconfig expire après un certain temps (généralement 3 mois).
Vous devrez répéter cette opération périodiquement.

Pour vérifier que votre kubeconfig utilise un token:
grep -A 5 "user:" ~/.kube/config

Vous devriez voir "token:" au lieu de "exec:" dans la section user.

